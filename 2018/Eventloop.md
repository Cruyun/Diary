# Event Loop
JSæ˜¯ä¸€é—¨éé˜»å¡å•çº¿ç¨‹ç¼–ç¨‹è¯­è¨€ï¼Œå› ä¸ºåœ¨æœ€åˆ JS å°±æ˜¯ä¸ºäº†å’Œæµè§ˆå™¨äº¤äº’è€Œè¯ç”Ÿçš„ã€‚å¦‚æœ JS æ˜¯é—¨å¤šçº¿ç¨‹çš„è¯­è¨€è¯ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¤„ç† DOM å°±å¯èƒ½ä¼šå‘ç”Ÿé—®é¢˜ï¼ˆä¸€ä¸ªçº¿ç¨‹ä¸­æ–°åŠ èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ é™¤èŠ‚ç‚¹ï¼‰ï¼Œå½“ç„¶å¯ä»¥å¼•å…¥è¯»å†™é”è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

## æµè§ˆå™¨ç¯å¢ƒä¸­çš„Event loop
### æ‰§è¡Œæ ˆå’Œäº‹ä»¶é˜Ÿåˆ—

*æ‰§è¡Œæ ˆï¼š*

å½“ JavaScript ä»£ç æ‰§è¡Œçš„æ—¶å€™ä¼šå°†ä¸åŒçš„å˜é‡å­˜äºå†…å­˜ä¸­çš„ä¸åŒä½ç½®ï¼š

- å †ï¼ˆheapï¼‰ï¼šå¯¹è±¡ï¼Œ å¼•ç”¨æ•°æ®æµè¡Œåœ°å€ï¼ŒåŸºç¡€æ•°æ®ç±»å‹ï¼Œ
- æ ˆï¼ˆsatckï¼‰ï¼šå‡½æ•°è°ƒç”¨
- æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šæ–¹æ³•çš„ç§æœ‰ä½œç”¨åŸŸï¼Œä¸Šå±‚ä½œç”¨åŸŸçš„æŒ‡å‘ï¼Œæ–¹æ³•çš„å‚æ•°ï¼Œä½œç”¨åŸŸä¸­çš„å¯¹è±¡ä»¥åŠ this
- æ‰§è¡Œæ ˆï¼šå½“ä¸€ç³»åˆ—æ–¹æ³•è¢«ä¾æ¬¡è°ƒç”¨æ—¶ï¼Œç”±äºJSæ˜¯å•çº¿ç¨‹çš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªæ–¹æ³•ï¼Œäºæ˜¯è¿™äº›æ–¹æ³•è¢«æ’é˜Ÿåœ¨ä¸€ä¸ªå•ç‹¬çš„åœ°æ–¹ï¼Œå³*æ‰§è¡Œæ ˆ*ã€‚

ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶ä¼šå‘æ‰§è¡Œæ ˆä¸­åŠ å…¥è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œç¯å¢ƒã€‚

*äº‹ä»¶é˜Ÿåˆ—ï¼š* æ‰§è¡Œå¼‚æ­¥äº‹ä»¶

JSå¼•æ“é‡åˆ°ä¸€ä¸ªå¼‚æ­¥äº‹ä»¶æ—¶ï¼Œä¸ä¼šä¸€ç›´ç­‰å¾…å…¶è¿”å›ç»“æœï¼Œè€Œä¼šå°†è¿™ä¸ªæ—¶é—´æŒ‚èµ·ï¼Œç»§ç»­æ‰§è¡Œ æ‰§è¡Œæ ˆä¸­çš„å…¶ä»–äº‹ä»¶ã€‚å½“ä¸€ä¸ªä¸€æ­¥äº‹ä»¶è¿”å›ç»“æœæ—¶ï¼ŒJSä¼šå°†è¿™ä¸ªäº‹ä»¶åŠ å…¥ä¸å½“å‰æ‰§è¡Œæ ˆä¸åŒçš„å¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå³*äº‹ä»¶é˜Ÿåˆ—*ã€‚

äº‹ä»¶é˜Ÿåˆ—ä¸­çš„æ–¹æ³•ä¸ä¼šç«‹åˆ»æ‰§è¡Œå…¶å›è°ƒå‡½æ•°ï¼Œè€Œæ˜¯ç­‰å¾…å½“å‰æ‰§è¡Œæ ˆä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œä¸»çº¿ç¨‹å¤„äºé—²ç½®çŠ¶æ€æ—¶ï¼Œä¸»çº¿ç¨‹å›å»æŸ¥æ‰¾äº‹ä»¶é˜Ÿåˆ—æ˜¯éƒ½æœ‰ä»»åŠ¡ã€‚å¦‚æœæœ‰ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹ä¼šä»ä¸­å–å‡ºé˜Ÿé¦–çš„æ—¶é—´ï¼Œå°†äº‹ä»¶çš„å›è°ƒæ”¾å…¥æ‰§è¡Œæ ˆä¸­ï¼Œç„¶åæ‰§è¡Œå…¶ä¸­çš„åŒæ­¥ä»£ç ã€‚åå¤å¦‚æ­¤ï¼Œå½¢æˆEvent Loopã€‚

### å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡

ä¸åŒçš„å¼‚æ­¥ä»»åŠ¡è¢«åˆ†ä¸ºä¸¤ç±»ï¼š
1. å¾®ä»»åŠ¡ï¼ˆmicro task or  jobsï¼‰ï¼š

- `process.nextTick`ï¼ˆnode.jsï¼‰
- `promise.then`
- `Object.observe`
- `MutationObserver`

2. å®ä»»åŠ¡ï¼ˆmacro task or tasksï¼‰ï¼š
- `script`
- `setTimeout`
- `setImmediate`ï¼ˆnodejsï¼‰
- `I/O`
-  `UI redering`
- `psotMessage`
- MessageChannel

å½“ å½“å‰æ‰§è¡Œæ ˆæ‰§è¡Œå®Œæ¯•æ—¶ï¼š
1. æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„äº‹ä»¶
2. ç„¶åå†å»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶

å¾®ä»»åŠ¡ä¸ä¸€å®šå¿«äºå®ä»»åŠ¡ã€‚å› ä¸ºå®ä»»åŠ¡ä¸­åŒ…æ‹¬äº† script ï¼Œæµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥æœ‰å¼‚æ­¥ä»£ç çš„è¯å°±å…ˆæ‰§è¡Œå¾®ä»»åŠ¡ã€‚

### ä¸€æ¬¡ Event loop é¡ºåº
1. æ‰§è¡ŒåŒæ­¥ä»£ç ï¼ˆå®ä»»åŠ¡ï¼‰
2. æ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å¾®ä»»åŠ¡
3. æ‰§è¡Œå¾®ä»»åŠ¡
4. å¿…è¦æ—¶æ¸²æŸ“UI
5. å¼€å§‹ä¸‹ä¸€è½®Event loop ï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç 

é€šè¿‡ä¸Šè¿°çš„ Event loop é¡ºåºå¯çŸ¥ï¼Œå¦‚æœå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç æœ‰å¤§é‡çš„è®¡ç®—å¹¶ä¸”éœ€è¦æ“ä½œ DOM çš„è¯ï¼Œä¸ºäº†æ›´å¿«çš„ ç•Œé¢å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œ DOM æ”¾å…¥å¾®ä»»åŠ¡ä¸­ã€‚

ğŸŒ°ï¼š

```
setTimeout(function () {
    console.log(1);
});

new Promise(function(resolve,reject){
    console.log(2)
    resolve(3)
}).then(function(val){
    console.log(val);
})
// 2 3 1
```

```
console.log('script start');

setTimeout(function() {
  console.log('setTimeout');
}, 0);

new Promise((resolve) => {
    console.log('Promise')
    resolve()
}).then(function() {
  console.log('promise1');
}).then(function() {
  console.log('promise2');
});

console.log('script end');
// script start => Promise => script end => promise1 => promise2 => setTimeout
```


## Node.jsç¯å¢ƒ
nodeä¸­äº‹ä»¶å¾ªç¯çš„å®ç°æ˜¯ä¾é çš„libuvå¼•æ“ã€‚æˆ‘ä»¬çŸ¥é“nodeé€‰æ‹© Chrome V8å¼•æ“ä½œä¸ºjsè§£é‡Šå™¨ï¼Œv8å¼•æ“å°†jsä»£ç åˆ†æåå»è°ƒç”¨å¯¹åº”çš„node apiï¼Œè€Œè¿™äº›apiæœ€ååˆ™ç”±libuvå¼•æ“é©±åŠ¨ï¼Œæ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡ï¼Œå¹¶æŠŠä¸åŒçš„äº‹ä»¶æ”¾åœ¨ä¸åŒçš„é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸»çº¿ç¨‹æ‰§è¡Œã€‚ å› æ­¤å®é™…ä¸Šnodeä¸­çš„äº‹ä»¶å¾ªç¯å­˜åœ¨äºlibuvå¼•æ“ä¸­ã€‚

### äº‹ä»¶æœºåˆ¶æ¨¡å‹

```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€>â”‚           timers          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     pending callbacks     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚       idle, prepare       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   incoming:   â”‚
â”‚  â”‚           poll            â”‚<â”€â”€â”€â”€â”€â”¤  connections, â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   data, etc.  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚           check           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”¤      close callbacks      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> æ¯ä¸€ä¸ªç›’å­å¯¹åº”ä¸€ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å„è‡ªçš„é˜Ÿåˆ—

### 6ä¸ªé˜¶æ®µ

- *timersï¼š*æ‰§è¡Œ `setTimeout()` å’Œ `setInterval()` çš„å›è°ƒ

ä¸€ä¸ª timer æŒ‡å®šçš„æ—¶é—´å¹¶ä¸æ˜¯å‡†ç¡®æ—¶é—´ï¼Œè€Œæ˜¯åœ¨è¾¾åˆ°è¿™ä¸ªæ—¶é—´åå·¨å¿«æ‰§è¡Œå›è°ƒï¼Œå¯èƒ½ä¼šå› ä¸ºç³»ç»Ÿæ­£åœ¨æ‰§è¡Œåˆ«çš„äº‹ä»¶è€Œå»¶è¿Ÿã€‚

å³ä½¿å»¶æ—¶è®¾ä¸º0æ¯«ç§’ï¼Œä½†ç”±äº HTML5 æ ‡å‡†è§„å®šè¿™ä¸ªå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ä¸å¾—å°äº 4 æ¯«ç§’ï¼Œæ‰€ä»¥å®é™…ä¸Šä¸æ˜¯0æ¯«ç§’å»¶æ—¶ã€‚

- *pending callbacksï¼š*æ‰§è¡ŒIOï¼ˆé™¤äº† close äº‹ä»¶ï¼Œå®šæ—¶å™¨å’Œ `setImmediate`ï¼‰å›è°ƒ
- *idle, prepareï¼š*å†…éƒ¨å®ç°
- *pollï¼š* æ‰§è¡Œåˆ°ç‚¹çš„è®¡æ—¶å™¨ï¼Œpoll é˜Ÿåˆ—ä¸­çš„äº‹ä»¶

å½“ poll ä¸­æ²¡æœ‰å®šæ—¶å™¨çš„æƒ…å†µä¸‹ï¼Œä¼šå‘ç°ä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…
- å¦‚æœ poll é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¼šéå†å›è°ƒé˜Ÿåˆ—å¹¶åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…ç³»ç»Ÿé™åˆ¶
- å¦‚æœ poll é˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šæœ‰ä¸¤ä»¶äº‹å‘ç”Ÿ
 - å¦‚æœæœ‰ setImmediate éœ€è¦æ‰§è¡Œï¼Œpoll é˜¶æ®µä¼šåœæ­¢å¹¶ä¸”è¿›å…¥åˆ° check é˜¶æ®µæ‰§è¡Œ setImmediate
 - å¦‚æœæ²¡æœ‰ setImmediate éœ€è¦æ‰§è¡Œï¼Œä¼šç­‰å¾…å›è°ƒè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶ç«‹å³æ‰§è¡Œå›è°ƒ
å¦‚æœæœ‰åˆ«çš„å®šæ—¶å™¨éœ€è¦è¢«æ‰§è¡Œï¼Œä¼šå›åˆ° timer é˜¶æ®µæ‰§è¡Œå›è°ƒã€‚

æ€»ç»“ï¼š

å…ˆæŸ¥çœ‹ poll queue ä¸­æ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæœ‰å°±æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œå®Œã€‚å½“ queue ä¸ºç©ºæ—¶ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰setImmediate()éœ€è¦æ‰§è¡Œã€‚å¦‚æœæœ‰ï¼Œé‚£ä¹ˆä¼šåœæ­¢ å¹¶è¿›å…¥ check é˜¶æ®µæ‰§è¡ŒsetImmediateï¼›å¦‚æœæ²¡æœ‰ï¼Œä¼šåœç•™ç­‰å¾…ï¼ŒçŸ¥é“ä¸€ä¸ªI/Oè¢«åŠ å…¥é˜Ÿåˆ—é‡Œé¢å¹¶ç«‹åˆ»æ‰§è¡Œå…¶å›è°ƒã€‚åŒæ—¶ä¼šæ£€æŸ¥æ˜¯å¦æœ‰åˆ°æœŸçš„å®šæ—¶å™¨ï¼Œå¦‚æœæœ‰å°±å›åˆ° timer é˜¶æ®µå»æ‰§è¡Œå™¨å›è°ƒã€‚

- *checkï¼š*æ‰§è¡Œ `setImmediate()` çš„å›è°ƒ
- *close callbacksï¼š*ä¸€äº› close äº‹ä»¶çš„å›è°ƒï¼Œå¦‚`socket.on('close', ...)`

åœ¨æ¯ä¸€è½® event loop é‡Œï¼ŒNode.jséƒ½ä¼šæ£€æŸ¥æ˜¯å¦æœ‰åŒæ­¥IOæˆ–è€…è®¡æ—¶å™¨åœ¨ç­‰å¾…æ‰§è¡Œï¼Œ å¦‚æœæ²¡æœ‰ï¼Œå°±æ¸…ç©ºã€‚

### setImmediate() vs setTimeout()
äºŒè€…å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä»–ä»¬åœ¨è°ƒç”¨çš„ä¸åŒå†³å®šäº†è¡Œä¸ºçš„ä¸åŒ

- setImmediate() ï¼šä¸€æ—¦æœ€è¿‘çš„ poll é˜¶æ®µå®Œæˆï¼Œå®ƒç”¨äºæ‰§è¡Œä¸€æ®µè„šæœ¬ã€‚
- setTimeout()ï¼šå®‰æ’åœ¨ç»è¿‡æœ€å°é˜ˆå€¼ï¼ˆmsåï¼‰æ‰§è¡Œçš„è„šæœ¬ã€‚

ä»–ä»¬ä¹‹é—´çš„é¡ºåºæœ‰æ—¶å€™æ˜¯éšæœºçš„ï¼š

```
setTimeout(() => {
    console.log('setTimeout');
}, 0);
setImmediate(() => {
    console.log('setImmediate');
})
// è¿™é‡Œå¯èƒ½ä¼šè¾“å‡º setTimeoutï¼ŒsetImmediate
// å¯èƒ½ä¹Ÿä¼šç›¸åçš„è¾“å‡ºï¼Œè¿™å–å†³äºæ€§èƒ½
// å› ä¸ºå¯èƒ½è¿›å…¥ event loop ç”¨äº†ä¸åˆ° 1 æ¯«ç§’ï¼Œè¿™æ—¶å€™ä¼šæ‰§è¡Œ setImmediate
// å¦åˆ™ä¼šæ‰§è¡Œ setTimeout
```

åœ¨ä¸‹é¢è¿™ç§æƒ…å†µæ˜¯å›ºå®šçš„ï¼š

```
var fs = require('fs')

fs.readFile(__filename, () => {
    setTimeout(() => {
        console.log('timeout');
    }, 0);
    setImmediate(() => {
        console.log('immediate');
    });
});
// å› ä¸º readFile çš„å›è°ƒåœ¨ poll ä¸­æ‰§è¡Œ
// å‘ç°æœ‰ setImmediate ï¼Œæ‰€ä»¥ä¼šç«‹å³è·³åˆ° check é˜¶æ®µæ‰§è¡Œå›è°ƒ
// å†å» timer é˜¶æ®µæ‰§è¡Œ setTimeout
// æ‰€ä»¥ä»¥ä¸Šè¾“å‡ºä¸€å®šæ˜¯ setImmediateï¼ŒsetTimeout
```

### process.nextTick()

nodeä¸­å­˜åœ¨ç€ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå³nextTick queueã€‚

process.nextTick()ä¸æ˜¯ event loop é‡Œé¢çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯æ— è®º event loop ä½äºå“ªä¸ªé˜¶æ®µï¼Œ`nextTickQueue`éƒ½ä¼šåœ¨å½“å‰æ“ä½œå®Œæˆåè¢«æ‰§è¡Œã€‚

å½“äº‹ä»¶å¾ªç¯å‡†å¤‡è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µä¹‹å‰ï¼Œä¼šå…ˆæ£€æŸ¥nextTick queueä¸­æ˜¯å¦æœ‰ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆä¼šå…ˆæ¸…ç©ºè¿™ä¸ªé˜Ÿåˆ—ã€‚ 

è¿™å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›ä¸è‰¯æƒ…å†µï¼Œå› ä¸ºå®ƒå…è®¸ä½ é€šè¿‡è¿›è¡Œé€’å½’ `process.nextTickï¼ˆï¼‰`è°ƒç”¨æ¥â€œstarveâ€I / Oï¼Œè¿™ä¼šé˜»æ­¢äº‹ä»¶å¾ªç¯åˆ°è¾¾è½®è¯¢é˜¶æ®µã€‚

microTasks çš„æ‰§è¡Œæ—¶æœºæ˜¯å½“æ‰§è¡Œå®Œæ‰€æœ‰çš„ nextTick çš„å›è°ƒä¹‹åã€‚å‡å¦‚æ²¡æœ‰ process.nextTick å°±ç›´æ¥ä» node é‡Œé¢è°ƒç”¨ RunMicrotasks åŠ å¿«é€Ÿåº¦ã€‚

#### `process.nextTick()` vs `setImmediate()`

> `process.nextTick()` fires more immediately than `setImmediate()`.

### æµç¨‹
1. é¦–æ¬¡åŠ è½½ï¼šå°†è®¡æ—¶å™¨ï¼ˆ setTimeoutã€setInterval ï¼‰çš„å›è°ƒæ³¨å†Œåˆ° timerçš„é˜Ÿåˆ—ä¸­ï¼Œå°† Promise.resolve ç­‰ microTask çš„å›è°ƒæ³¨å†Œåˆ° microTasksï¼Œå°† setImmediate æ³¨å†Œåˆ° immediate Queue ä¸­ï¼Œå°† process.nextTick æ³¨å†Œåˆ° nextTick Queue ä¸­ã€‚
2. event loop å¼€å§‹ï¼šè¿›å…¥ timersï¼Œæ‰§è¡Œåˆ°æœŸçš„è®¡æ—¶å™¨
3. è¿›å…¥ pollï¼šè¯¦è§ä¸Šé¢ poll é˜¶æ®µæ€»ç»“
4. checkï¼šæ‰§è¡Œ setImmediateçš„å›è°ƒ
5. æ¯æ¬¡åˆ‡æ¢é˜¶æ®µå‰éƒ½æ£€æŸ¥æ˜¯å¦æœ‰ nextTick å’Œ microTasksã€‚åŒæ­¥è¯»å–å®Œååˆ°å¼‚æ­¥ timer é˜¶æ®µå¼€å§‹ä¹Ÿæ˜¯åˆ‡æ¢äº†é˜¶æ®µï¼Œä¹Ÿè¦å…ˆæ¸…ç©ºä¸€æ¬¡nextTick å’Œ microTasksã€‚

ä¸€ä¸ªå¤æ‚çš„ä¾‹å­è§ï¼š[åšé¢è¯•çš„ä¸å€’ç¿ï¼šä¸€é“äº‹ä»¶å¾ªç¯é¢˜å¼•å‘çš„è¡€æ¡ˆ - æ˜é‡‘](https://juejin.im/post/5bbee9d36fb9a05cff32388d)

å‚è€ƒåŠæ¨èé˜…è¯»ï¼š

- éƒ¨åˆ†åŸæ–‡ç¿»è¯‘è‡ª[The Node.js Event Loop, Timers, and process.nextTick() | Node.js](https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/)
- [Concurrency model and Event Loop | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)
- [CS-Interview-Knowledge-Map/browser-ch.md at master Â· InterviewMap/CS-Interview-Knowledge-Map Â· GitHub](https://github.com/InterviewMap/CS-Interview-Knowledge-Map/blob/master/Browser/browser-ch.md#event-loop)
- [SUMMARY/event_loop.md at master Â· fengzi2016/SUMMARY Â· GitHub](https://github.com/fengzi2016/SUMMARY/blob/master/interview/event_loop.md)
